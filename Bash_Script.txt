module load eth_proxy
export PATH=/cluster/home/moverath/sratoolkit.2.10.7-ubuntu64/bin:$PATH

bsub -M 4000 -n 4 -W 20:00 -e error.txt -o output.txt 'while IFS= read -r I;do 
fasterq-dump "$I";
. /cluster/scratch/moverath/miniconda3/etc/profile.d/conda.sh;
conda activate artic-ncov2019;
artic minion --medaka --normalise 200 --threads 4 --scheme-directory /cluster/home/moverath/artic-ncov2019/primer_schemes --read-file $I.fastq nCoV-2019/V3 "$I";
conda activate pangolin;
samtools coverage $I.sorted.bam -o "$I"_coverage.txt;
pangolin $I.consensus.fasta --outfile "$I"_lineage.csv;
done < /cluster/home/moverath/run_ids.txt'



while IFS= read -r I;do
echo $I;
bsub -M 4000 -n 4 -e error2.txt -o output2.txt 'fasterq-dump "$I"; . /cluster/scratch/moverath/miniconda3/etc/profile.d/conda.sh; conda activate artic-ncov2019; artic minion --medaka --normalise 200 --threads 4 --scheme-directory /cluster/home/moverath/artic-ncov2019/primer_schemes --read-file $I.fastq nCoV-2019/V3 "$I"; conda activate pangolin; samtools coverage $I.sorted.bam -o "$I"_coverage.txt; pangolin $I.consensus.fasta --outfile "$I"_lineage.csv'
done < /cluster/home/moverath/run_ids3.txt